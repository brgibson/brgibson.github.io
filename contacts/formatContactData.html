<textarea onkeypress="convertTabularDataToSemanticMarkup(this)" 
          onchange="convertTabularDataToSemanticMarkup(this)"
          placeholder="Copy and past elements from data.html's table" rows="15" cols="80"></textarea>

<pre id="output">
   Expected Input:
   
   <!-- full input
        <tr><td class="hd"><p style="height: 16px;">.</p></td><td class="s2">Amar</td><td class="s3">amardeep@live.com</td><td class="s3">408-555-1234</td><td class="s3">555 Halford Ave.</td><td class="s3">Apartment #43C</td><td class="s3">Santa Clara</td><td class="s3">CA</td><td class="s4">95051</td></tr><tr><td class="hd"><p style="height: 16px;">.</p></td><td class="s2">Deepa</td><td class="s3">deepa@yahoo.com</td><td class="s3">408-555-1234</td><td class="s3">1234 Montcalm St.</td><td></td><td class="s3">Chula Vista</td><td class="s3">CA</td><td class="s4">91911</td></tr><tr><td class="hd"><p style="height: 16px;">.</p></td><td class="s2">Eric</td><td class="s3">eric@ericrules.com</td><td class="s3">408-555-1234</td><td class="s3">10 Candyland</td><td></td><td class="s3">North Pole</td><td class="s3">PA</td><td class="s4">87996</td></tr><tr><td class="hd"><p style="height: 16px;">.</p></td><td class="s2">Gregor</td><td class="s3">gregor@gmail.com</td><td class="s3">897-984-3145</td><td class="s3">Gregor Insurance Co.</td><td class="s3">1234 Strip St.</td><td class="s3">New York</td><td class="s3">NY</td><td class="s4">45879</td></tr><tr><td class="hd"><p style="height: 16px;">.</p></td><td class="s2">Jeff</td><td class="s3">jeff@aol.com</td><td class="s3">408-555-1234</td><td class="s3">1234 Montcalm St.</td><td></td><td class="s3">Chula Vista</td><td class="s3">CA</td><td class="s4">91911</td></tr><tr><td class="hd"><p style="height: 16px;">.</p></td><td class="s2">Jen</td><td class="s3">jen@ebay.com</td><td class="s3">408-555-1234</td><td class="s3">1234 Lily St.</td><td></td><td class="s3">San Diego</td><td class="s3">CA</td><td class="s4">91911</td></tr><tr><td class="hd"><p style="height: 16px;">.</p></td><td class="s2">Katie</td><td class="s3">katie@ask.com</td><td class="s3">415-555-1234</td><td class="s3">949 Thunk Ct.</td><td></td><td class="s3">Sacramento</td><td class="s3">CA</td><td class="s4">95826</td></tr><tr><td class="hd"><p style="height: 16px;">.</p></td><td class="s2">Vivian</td><td class="s3">vivian@altavista.com</td><td class="s3">650-458-1234</td><td class="s3">949 FooBar St.</td><td></td><td class="s3">San Mateo</td><td class="s3">CA</td><td class="s4">98745</td></tr>
    -->
   &lt;tr&gt;&lt;td class="hd"&gt;&lt;p style="height: 16px;"&gt;.&lt;/p&gt;&lt;/td&gt;&lt;td class="s2"&gt;Amar&lt;/td&gt;&lt;td class="s3"&gt;amardeep@live.com&lt;/td&gt;&lt;td class="s3"&gt;408-555-1234&lt;/td&gt;&lt;td class="s3"&gt;555 Halford Ave.&lt;/td&gt;&lt;td class="s3"&gt;Apartment #43C&lt;/td&gt;&lt;td class="s3"&gt;Santa Clara&lt;/td&gt;&lt;td class="s3"&gt;CA&lt;/td&gt;&lt;td class="s4"&gt;95051&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="hd"&gt;&lt;p style="height: 16px;"&gt;.&lt;/p&gt;&lt;/td&gt;&lt;td class="s2"&gt;Deepa&lt;/td&gt;&lt;td class="s3"&gt;deepa@yahoo.com&lt;/td&gt;&lt;td class="s3"&gt;408-555-1234&lt;/td&gt;&lt;td class="s3"&gt;1234 Montcalm St.&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td class="s3"&gt;Chula Vista&lt;/td&gt;&lt;td class="s3"&gt;CA&lt;/td&gt;&lt;td class="s4"&gt;91911&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="hd"&gt;&lt;p style="height: 16px;"&gt;.&lt;/p&gt;&lt;/td&gt;&lt;td class="s2"&gt;Eric&lt;/td&gt;&lt;td class="s3"&gt;eric@ericrules.com&lt;/td&gt;&lt;td class="s3"&gt;408-555-1234&lt;/td&gt;&lt;td class="s3"&gt;10 Candyland&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td class="s3"&gt;North Pole&lt;/td&gt;&lt;td class="s3"&gt;PA&lt;/td&gt;&lt;td class="s4"&gt;87996&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="hd"&gt;&lt;p style="height: 16px;"&gt;.&lt;/p&gt;&lt;/td&gt;&lt;td class="s2"&gt;Gregor&lt;/td&gt;&lt;td class="s3"&gt;gregor@gmail.com&lt;/td&gt;&lt;td class="s3"&gt;897-984-3145&lt;/td&gt;&lt;td class="s3"&gt;Gregor Insurance Co.&lt;/td&gt;&lt;td class="s3"&gt;1234 Strip St.&lt;/td&gt;&lt;td class="s3"&gt;New York&lt;/td&gt;&lt;td class="s3"&gt;NY&lt;/td&gt;&lt;td class="s4"&gt;45879&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="hd"&gt;&lt;p style="height: 16px;"&gt;.&lt;/p&gt;&lt;/td&gt;&lt;td class="s2"&gt;Jeff&lt;/td&gt;&lt;td class="s3"&gt;jeff@aol.com&lt;/td&gt;&lt;td class="s3"&gt;408-555-1234&lt;/td&gt;&lt;td class="s3"&gt;1234 Montcalm St.&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td class="s3"&gt;Chula Vista&lt;/td&gt;&lt;td class="s3"&gt;CA&lt;/td&gt;&lt;td class="s4"&gt;91911&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="hd"&gt;&lt;p style="height: 16px;"&gt;.&lt;/p&gt;&lt;/td&gt;&lt;td class="s2"&gt;Jen&lt;/td&gt;&lt;td class="s3"&gt;jen@ebay.com&lt;/td&gt;&lt;td class="s3"&gt;408-555-1234&lt;/td&gt;&lt;td class="s3"&gt;1234 Lily St.&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td class="s3"&gt;San Diego&lt;/td&gt;&lt;td class="s3"&gt;CA&lt;/td&gt;&lt;td class="s4"&gt;91911&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="hd"&gt;&lt;p style="height: 16px;"&gt;.&lt;/p&gt;&lt;/td&gt;&lt;td class="s2"&gt;Katie&lt;/td&gt;&lt;td class="s3"&gt;katie@ask.com&lt;/td&gt;&lt;td class="s3"&gt;415-555-1234&lt;/td&gt;&lt;td class="s3"&gt;949 Thunk Ct.&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td class="s3"&gt;Sacramento&lt;/td&gt;&lt;td class="s3"&gt;CA&lt;/td&gt;&lt;td class="s4"&gt;95826&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="hd"&gt;&lt;p style="height: 16px;"&gt;.&lt;/p&gt;&lt;/td&gt;&lt;td class="s2"&gt;Vivian&lt;/td&gt;&lt;td class="s3"&gt;vivian@altavista.com&lt;/td&gt;&lt;td class="s3"&gt;650-458-1234&lt;/td&gt;&lt;td class="s3"&gt;949 FooBar St.&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td class="s3"&gt;San Mateo&lt;/td&gt;&lt;td class="s3"&gt;CA&lt;/td&gt;&lt;td class="s4"&gt;98745&lt;/td&gt;&lt;/tr&gt;
   
   or
   
    &lt;td class="hd"&gt;
        &lt;p style="height: 16px;"&gt;.&lt;/p&gt;
    &lt;/td&gt;
    &lt;td class="s2"&gt;Amar&lt;/td&gt;
    &lt;td class="s3"&gt;amardeep@live.com&lt;/td&gt;
    &lt;td class="s3"&gt;408-555-1234&lt;/td&gt;
    &lt;td class="s3"&gt;555 Halford Ave.&lt;/td&gt;
    &lt;td class="s3"&gt;Apartment #43C&lt;/td&gt;
    &lt;td class="s3"&gt;Santa Clara&lt;/td&gt;
    &lt;td class="s3"&gt;CA&lt;/td&gt;
    &lt;td class="s4"&gt;95051&lt;/td&gt;
    
</pre>

<script>
    var convertTabularDataToSemanticMarkup = (function() {
        
        /**
         * Initialization section
         */
        
        /* an object to parse the tabular entries in data.html */
        var dataParser = (function() {
            var dataToParse = "";
            
            /* helper functions */
            function removeNewlines(str) {
                return str.replace(/\n/g, " ");
            }
            
            function getString(regex) {
                var result = regex.exec(dataToParse);
                return result && result[1];
            }
            
            /* object to be returned */
            return {
                setDataToParse : function (dataStr) {
                    dataToParse = removeNewlines(dataStr);
                },
                getName : function() {
                    return getString(/s2\">(.+?)<.*/g);
                },
                getEmail : function() {
                    return getString(/s3\">(.+?)<.*/g);
                },
                getPhone : function() {
                    return getString(/s3.+?s3\">(.+?)<.*/g);
                },
                getAddress : function() {
                    var line1 = getString(/s3.+?s3.+?s3\">(.+?)<.*/g);
                    var line2 = getString(/s3.+?s3.+?s3.+?s3\">(.+?)<.*/g);
                    var city = getString(/s3.+?s3.+?s3.+?s3.+?s3\">(.+?)<.*/g);
                    var state = getString(/s3.+?s3.+?s3.+?s3.+?s3.+?s3\">(.+?)<.*/g);
                    var zip = getString(/s4\">(.+?)<.*/g);
                    
                    return "\n    " + 
                        line1 + "\n    " + 
                        line2 + "\n    " + 
                        city + ", " + state + "\n    " + 
                        zip;
                },
                getMapUrl : function() {
                    return "#";
                },
                getChatsUrl : function() {
                    return "#";
                },
                getEmailsUrl : function() {
                    return "#";
                }
            }
        })();
        
        /* an object to build the markup that we want for the entries in our contacts widget */
        var markupBuilder = (function() {
            /* private markup variable */
            var markup;
            
            /* helper function */
            function encodeSpecialCharacters(str) {
                return str
                        .replace(/</g, "&lt;")
                        .replace(/>/g, "&gt;")
                        .replace(/\//g, "&frasl;")
                        ;
            }
            
            /* object to be returned */
            return {
                init : function() { 
                    markup = ""; 
                },
                getMarkup : function() { 
                    return encodeSpecialCharacters(markup + "\n");
                },
                addName : function(name) { 
                    markup += "<dt class='name'>"+ name +"</dt>\n"; 
                },
                addEmail : function(email) { 
                    markup += "<dd class='email'>"+ email +"</dd>\n"; 
                },
                addPhone : function(phone) { 
                    markup += "<dd class='phone'>"+ phone +"</dd>\n"; 
                },
                addAddress : function(address) { 
                    markup += "<dd class='address'>"+ address +"\n</dd>\n"; 
                },
                addMapUrl : function(mapUrl) { 
                    markup += "<dd><a href='"+ mapUrl +"'>map</a></dd>\n"; 
                },
                addChatsUrl : function(chatsUrl) { 
                    markup += "<dd><a href='"+ chatsUrl +"'>Chats</a></dd>\n"; 
                },
                addEmailsUrl : function(emailsUrl) { 
                    markup += "<dd><a href='"+ emailsUrl +"'>Emails</a></dd>\n"; 
                }
            };            
            
            
        })();
        
        /**
         * Return the eventHandler we will be using to convert and output the data.
         */
        var outputElement = document.getElementById('output');
        
        return function(elem) {
            var markup = "";
                
            for (var i = 1, entries = elem.value && elem.value.split("<tr>"); i < entries.length ; i++) {
                dataParser.setDataToParse(entries[i]);

                markupBuilder.init();
                markupBuilder.addName(dataParser.getName());
                markupBuilder.addEmail(dataParser.getEmail());
                markupBuilder.addPhone(dataParser.getPhone());
                markupBuilder.addAddress(dataParser.getAddress());
                markupBuilder.addMapUrl(dataParser.getMapUrl());
                markupBuilder.addChatsUrl(dataParser.getChatsUrl());
                markupBuilder.addEmailsUrl(dataParser.getEmailsUrl());
                
                markup += markupBuilder.getMarkup();
            }
            outputElement.innerHTML = markup;
        };
    })();
</script>