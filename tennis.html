<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="UTF-8"/>
	<title>Ben's Experiments - Tennis Standings</title>
	<script type='text/javascript' src='./knockout/knockout-2.3.0.js'></script>
	<!--link rel="stylesheet" href="./base.css" /-->	
	<style>
	body {
		font-family: helvetica;
 	 	font-weight: 300;
	}
	table {
		border-collapse: collapse;
		background-color: #efe;
		/*
	  -moz-box-shadow:    3px 3px 5px 6px #ccc;
	  -webkit-box-shadow: 3px 3px 5px 6px #ccc;
	  box-shadow:         3px 3px 5px 6px #ccc;
		*/
	}
	tr {
		border: solid 1px green;
	}
	thead {
		background-color: #fff;
	}
	th {
		padding: 1em;
	}
	td {
		font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
		padding: .7em 1em;
	}
	ul {
		padding: 0;
		margin: 0;
	}
	li {
		display:block;
	}
	.opponent {
		white-space: nowrap;
	}
	.win {
		background-color: lightgreen;
	}
	.lose {
		background-color: lightpink;
	}
	.oof {
		opacity: 0.4;
	}
	@media all and (max-width: 1080px) and (orientation: landscape) {
		body {
  			font-size: .85em;
		}
		h1 {
			display: none;
		}
	}
	@media all and (max-width: 980px) and (orientation: portrait) {
		body {
  			font-size: .95em;
		}
	}
	@media all and (orientation: landscape) {
		.score {
			white-space: nowrap;
		}
		.score li {
			display: inline;
			margin-right: -.3em;
		}
	}
	@media all and (orientation: portrait) {
		.score span {
			display: none;
		}
	}
	
	table, thead {
		-moz-transition: background 1.5s;
		-o-transition: background 1.5s;
		-webkit-transition: background 1.5s;
		transition: background 1.5s;
	}
	</style>
</head>

<body>
	<h1>Tennis Standings</h1>
	<div class="tennis">
		<table class="landscape">
			<thead id="test">
				<tr>
					<th data-bind="click: playerNameSort">Player Name</th>
					<th data-bind="click: ratingSort">Rating</th>
					<th data-bind="click: pointsSort">Total Points</th>
					<!-- ko foreach: players()[0].matches -->	
					<th data-bind="click: function() {$parent.pointsInMatchSort($index())},
						 				text: ($index() + 1)"></th>
					<!-- /ko -->
				</tr>
			</thead>
			<tbody data-bind="foreach: players"> 
				<tr>
					<td data-bind="text: playerName,
					 					click: function() {$parent.highlightPlayer(playerName)}, clickBubble: false,
										css: isOutOfFocus() ? 'oof' : ''"></td>
					<td data-bind="text: rating, css: isOutOfFocus() ? 'oof' : ''"></td>
					<td data-bind="text: points, css: isOutOfFocus() ? 'oof' : ''"></td>
					<!-- ko foreach: matches -->	
					<td style="text-align: center"
						 data-bind="css: isOutOfFocus() ? 'oof ' + cssClass : cssClass,
						 				click: function() {$root.highlightPlayer(opponent)}, clickBubble: false">
						<ul>
							<ul class="score" data-bind="foreach: games">
								<li><!-- ko text: $data --><!-- /ko --><span data-bind="if: $parent.isNotLastGame($index())">,<span></li>
							</ul>
							<li class="opponent" data-bind="text: getOpponentAbbreviated()"></li>
							<li data-bind="text:points"></li>
						</ul>
					</td>
					<!-- /ko -->
				</tr>
			</tbody>
		</table>
		<script>
		/*
		<table style="display: none" class="portrait">
			<tr>
				<th data-bind="click: playerNameSort">Player Name</th>

				<!-- ko foreach: players -->					
				<td data-bind="text: getPlayerNameAbbreviated(),
				 					click: function() {$parent.highlightPlayer(playerName)}, clickBubble: false,
									css: isOutOfFocus() ? 'oof' : ''"></td>
				<!-- /ko -->
			</tr> 
			<tr>
				<th data-bind="click: ratingSort">Rating</th>
				<!-- ko foreach: players -->					
				<td data-bind="text: rating, css: isOutOfFocus() ? 'oof' : ''"></td>
				<!-- /ko -->
			</tr>
			<tr>
				<th data-bind="click: pointsSort">Total Points</th>
				<!-- ko foreach: players -->					
				<td data-bind="text: points, css: isOutOfFocus() ? 'oof' : ''"></td>
				<!-- /ko -->
			</tr>
			<!-- ko foreach: players()[0].matches -->								
			<tr>
				<th data-bind="click: function() {$root.pointsInMatchSort($index())},
					 				text: ($index() + 1)"></th>
				
				<!-- ko foreach: $root.players -->					
				<td style="text-align: center"
					 data-bind="css: isOutOfFocus() ? 'oof ' + matches[$parentContext.$index()].cssClass : matches[$parentContext.$index()].cssClass,
					 				click: function() {$root.highlightPlayer(matches[$parentContext.$index()].opponent)}, clickBubble: false">
					<ul>
						<li data-bind="text: matches[$parentContext.$index()].games, css: isOutOfFocus() ? 'oof' : ''"></li>
						<li class="opponent" data-bind="text: matches[$parentContext.$index()].getOpponentAbbreviated(), css: isOutOfFocus() ? 'oof' : ''"></li>
						<li data-bind="text: matches[$parentContext.$index()].points"></li>
					</ul>
				</td>
				<!-- /ko -->
			</tr>
			<!-- /ko -->
		</table>*/
		</script>

	</div>
</body>
<script type='text/javascript' src='./tennis/playerStats.js'></script>
<script type='text/javascript' src='./tennis/tennis-mock-data.js'></script>
<script type='text/javascript' src='./tennis/tennis-view-models.js'></script>
<script type='text/javascript' src='./tennis/tennis-view-model-adapter.js'></script>
<script> 
var useMockData = false;

if (useMockData) {
	ko.applyBindings(new TennisViewModel().setPlayers(mockPlayers));
} else {
	ko.applyBindings(new TennisViewModelAdapter(playerStats).adapt());
}

function blah() {	
	var throbColor = "#aaf";
	var throbMillis = 700;
	var thead = document.getElementsByTagName("thead")[0];
	var table = document.getElementsByTagName("table")[0];
	
	window.setTimeout(function() { throb(thead, throbColor, throbMillis) }, 250);
	window.setTimeout(function() { throb(table, throbColor, throbMillis) }, 1100);
};

function throb(elem, color, millis) {
	var origColor = elem.style.background;
	elem.style.background = color;

	window.setTimeout(
		function() {
			elem.style.background = origColor;
		}, millis);
}

blah();
</script>
</html>
