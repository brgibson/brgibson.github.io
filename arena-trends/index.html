---
layout: smash
category: smash
bodySelector: smash

title: Arena Cutoff Trends for Marvel Contest of Champions
keywords: mcoc, marvel contest of champions, arena, cutoff, trends, chart
description: An arena cutoff chart to help predict what the next cutoff will be by looking at trending.
---
<p>
    <a href="http://mbch.guide/en/arenas/istoriya-proxodnyx/">Arena Cutoff Data</a>
    <a href="https://docs.google.com/spreadsheets/d/1sJtSVnjhhRNxpiuMR5uXrsTlrsXMjp9TNO7JHDXhtsk/">Raw Arena Cutoff Data</a>
</p>

<style>

    .axis--x path {
        display: none;
    }

    .line {
        fill: none;
        stroke: steelblue;
        stroke-width: 1.5px;
    }

</style>
<svg width="960" height="500"></svg>
<script src="//d3js.org/d3.v4.min.js"></script>
<script>

    var svg = d3.select("svg"),
            margin = {top: 20, right: 80, bottom: 30, left: 70},
            width = svg.attr("width") - margin.left - margin.right,
            height = svg.attr("height") - margin.top - margin.bottom,
            g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var parseTime = d3.timeParse("%m/%d/%Y");

    var x = d3.scaleTime().range([0, width]),
            y = d3.scaleLinear().range([height, 0]),
            z = d3.scaleOrdinal(d3.schemeCategory10);

    var line = d3.line()
            .curve(d3.curveBasis)
            .x(function (d) {
                return x(d.date);
            })
            .y(function (d) {
                return y(d.temperature);
            });


    var getIntValue = (function() {
        var previousInt = 0;
        return function(numStr) {
            var toReturn;
            try {
                toReturn = parseInt(numStr.replace(/,/g, '')) || previousInt;
            } catch(ex) {
                toReturn = previousInt;
            } finally {
                previousInt = toReturn;
                return toReturn;
            }
        };
    })();



    ////////////////////////////////////////////////////////////////////////////
    var path;
    var axisX;
    var axisY;

    function formatJsonForD3(data) {
        var cities = [
            {
                id: "Featured",
                values: data.map(function (d) {
                    return {
                        date: parseTime(d.date),
                        temperature: getIntValue(d.scores[0])
                    };
                })
            },
            {
                id: "Basic",
                values: data.map(function (d) {
                    return {
                        date: parseTime(d.date),
                        temperature: getIntValue(d.scores[1])
                    };
                })
            }
        ];
        return cities;
    }
    function setDomainX(cities) {
        x.domain(d3.extent(cities[0].values, function (d) {
            return d.date;
        }));
    }
    function setDomainY(cities) {
        y.domain([
            d3.min(cities, function (c) {
                return d3.min(c.values, function (d) {
                    return d.temperature;
                });
            }),
            d3.max(cities, function (c) {
                return d3.max(c.values, function (d) {
                    return d.temperature;
                });
            })
        ]);
    }
    function setDomainZ(cities) {
        z.domain(cities.map(function (c) {
            return c.id;
        }));
    }
    function updateAxisX() {
        if (!axisX) {
            axisX = g.append("g").attr("class", "axis axis--x");
        }
        axisX
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));
    }
    function updateAxisY() {
        if (!axisY) {
            axisY = g.append("g").attr("class", "axis axis--y")
        }
        axisY
            .call(d3.axisLeft(y))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", "0.71em")
            .attr("fill", "#000")
            .text("Points");
    }
    function appendGraphData(city) {
        if (!path) {
            path = city.append("path");
        }
        path.attr("class", "line")
            .attr("d", function (d) {
                return line(d.values);
            })
            .style("stroke", function (d) {
                return z(d.id);
            });
    }
    function appendGraphDataLabels(city) {
        city.append("text")
                .datum(function (d) {
                    return {id: d.id, value: d.values[0]};
                })
                .attr("transform", function (d) {
                    return "translate(" + x(d.value.date) + "," + y(d.value.temperature) + ")";
                })
                .attr("x", 3)
                .attr("dy", "0.35em")
                .style("font", "10px sans-serif")
                .text(function (d) {
                    return d.id;
                });
    }
    ////////////////////////////////////////////////////////////////////////////

    var cities;
    var city;
    var data;

    d3.json("arena.json", function (error, jsonData) {

        if (error) {
            throw error;
        }

        data = jsonData;
        cities = formatJsonForD3(data);

        setDomainX(cities);
        setDomainY(cities);
        setDomainZ(cities);

        updateAxisX();
        updateAxisY();

        city = g.selectAll(".city")
                .data(cities)
                .enter().append("g")
                .attr("class", "city");

        appendGraphData(city);
        appendGraphDataLabels(city);
    });

    function updateXBounds(min, max) {
        updateAll(min, max, null, null);
    }

    function updateYBounds(min, max) {
        updateAll(null, null, min, max);
    }

    function updateAll(minX, maxX, minY, maxY) {
        var cities = formatJsonForD3(data);

        if (minX && maxX) {
            x.domain([
                minX,
                maxX
            ]);
        } else {
//            setDomainX(cities);
        }

        if (minY && maxY) {
            y.domain([
                minY,
                maxY
            ]);
        } else {
//            setDomainY(cities);
        }

        setDomainZ(cities);

        updateAxisX();
        updateAxisY();

        city = g.selectAll(".city")
                .data(cities)
                .enter().append("g")
                .attr("class", "city");

        appendGraphData(city);
        appendGraphDataLabels(city);
    }
</script>

<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>

function formatRange(min, max) {
    $("#amount").text(min.toLocaleString() + " - " + max.toLocaleString() );
}

$(function() {
    var startingMin = 2000000;
    var startingMax = 20000000;
    $( "#slider-range" ).slider({
      range: true,
      min: startingMin,
      max: startingMax,
      values: [ startingMin, startingMax ],
      slide: function( event, ui ) {
          updateYBounds(ui.values[ 0 ], ui.values[ 1 ]);
          formatRange(ui.values[0],ui.values[1]);
      }
    });
    formatRange(startingMin, startingMax);
});
</script>

<p>
  <label for="amount">Point range:</label>
  <p type="text" id="amount" style="border:0; color:#f6931f; font-weight:bold;"></p>
</p>

<div style="display:inline-block;width:300px" id="slider-range"></div>



<script>

$(function() {

    var startingMin = 1;
    var startingMax = {{site.data.arena.size}} - 1;
    $( "#slider-time" ).slider({
      range: true,
      min: startingMin,
      max: startingMax,
      values: [ startingMin, startingMax ],
      slide: function( event, ui ) {
          if (cities) {
              var start = cities[0].values[startingMax - ui.values[0]].date;
              var end = cities[0].values[startingMax - ui.values[1]].date;
              updateXBounds(start, end);
              $("#time").text(start.toLocaleDateString() + " - " + end.toLocaleDateString());
          }
      }
    });
});
</script>

<p>
  <label for="time">Time range:</label>
  <p type="text" id="time" style="border:0; color:#f6931f; font-weight:bold;"></p>
</p>

<div style="display:inline-block;width:300px;transform: scale(1, -1);" id="slider-time"></div>